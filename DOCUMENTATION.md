# Диздок проекта Symbiochi

## 1. Цели и видение
**Symbiochi** — экспериментальная эволюционная игра-тамагочи, где игрок влияет на среду и уход, а форма организма является результатом истории жизни и мутаций. Проект задуман как «цифровой организм», а не как симулятор с фиксированными правилами эволюции. Игрок не управляет мутациями напрямую: он влияет на состояние, а система сама подбирает рост и органы в зависимости от условий.【F:README.md†L1-L17】【F:README.md†L33-L56】

Ключевые принципы:
- **Непрямое управление**: игрок влияет на среду, а организм сам адаптируется.【F:README.md†L6-L17】
- **Постепенная эволюция**: мутации происходят по таймеру, без «кнопки мутации».【F:README.md†L18-L27】
- **Визуальная биоморфность**: форма тела меняется в зависимости от роста, стресса, мобильности и сенсоров.【F:README.md†L27-L56】

## 2. Целевая аудитория
- Любители «тамагочи» и медитативных симуляторов с долгосрочным прогрессом.
- Игроки, которым интересны непредсказуемые формы и эстетика «живых» процедурных существ.

## 3. Ключевые пользовательские сценарии
1. **Первый запуск**
   - Игрок открывает `index.html`, нажимает «ИГРАТЬ!» и видит первое существо в центре поля.【F:index.html†L54-L68】
2. **Уход и наблюдение**
   - Игрок кормит, моет, лечит и наблюдает, как организм меняется в ответ на состояние и время.【F:README.md†L63-L93】【F:js/rules-data.js†L23-L63】
3. **Долгосрочная эволюция**
   - Игрок возвращается через время и видит, как организм развился оффлайн (долгий прогресс учитывается).【F:README.md†L33-L41】【F:js/main.js†L115-L165】

## 4. UX и интерфейс
### 4.1 Основные экраны
- **Игровое поле (Canvas)**: главная зона рендера организма, взаимодействий и камеры.【F:index.html†L32-L52】
- **HUD**: текущие параметры, запас морковок, кнопки действий и настройки.【F:index.html†L10-L52】
- **Панель информации**: вкладки организм/легенда/журнал/правила.【F:index.html†L96-L140】

### 4.2 Управление
- Выбор организма, панорама, зум, кормление и журнал событий описаны в правилах UI.【F:js/rules-data.js†L1-L24】

## 5. Игровые механики
### 5.1 Организм и органы
- Существо состоит из **клеток** (блоков) и **органов** (модули типа глаз, лап, хвостов, панциря и т. п.).【F:README.md†L18-L33】
- Органы не появляются сразу большими — они растут постепенно.【F:README.md†L23-L33】
- Стадия существа зависит от общего количества блоков (логика стадий — в `getStageName`).【F:README.md†L23-L33】【F:js/creature.js†L96-L112】

### 5.2 Время и оффлайн-прогресс
- Система учитывает оффлайн-прогресс: за время отсутствия организм может сильно измениться.【F:README.md†L33-L41】
- `autoTick()` вычисляет дельту времени и вызывает `simulate()`, который обновляет состояние и лог.【F:js/main.js†L115-L165】【F:js/state.js†L171-L215】

### 5.3 Эволюция и мутации
- Мутации происходят раз в интервал (минуты мирового времени) и ограничены 2 мутациями за тик.【F:README.md†L33-L41】【F:js/rules-data.js†L55-L69】
- Влияния на мутации:
  - **Стиль ухода** (корм, мытьё, лечение, запущенность).【F:js/rules-data.js†L39-L53】
  - **Морфология и экология** (размер тела, стресс, сенсорика и т. п.), учитываемые в логике мутаций и почкования.【F:README.md†L43-L62】【F:js/state_mutation.js†L28-L73】

### 5.4 Почкование
- Длинный подвижный орган может отделиться и стать самостоятельной «почкой».【F:README.md†L63-L69】【F:js/rules-data.js†L70-L77】
- Почкование реализовано в логике мутаций (`state_mutation.js`).【F:js/state_mutation.js†L28-L73】

### 5.5 Кормление морковками
- Режим «КОРМ» бросает морковку 3×7, лимит — 3 морковки за тик мутации.【F:README.md†L71-L83】【F:js/rules-data.js†L23-L38】
- Близость морковки влияет на рост тела или отростков.【F:README.md†L77-L83】【F:js/rules-data.js†L33-L38】

## 6. Архитектура и модули
### 6.1 Точка входа
- HTML-страница `index.html` подключает `js/main.js` как ES-модуль, который инициализирует игру.【F:index.html†L1-L148】

### 6.2 Основные модули
- `js/main.js` — инициализация DOM, состояние `view`, циклы рендера/симуляции, и перерасчёт HUD/логов.【F:js/main.js†L1-L165】
- `js/state.js` — хранение состояния, сейвы, миграции, симуляция и оффлайн-прогресс.【F:js/state.js†L1-L215】
- `js/state_mutation.js` — мутации, экология, почкование и симбиоз геномов.【F:js/state_mutation.js†L1-L73】
- `js/render.js` — процедурный canvas-рендерер, работа с пиксельными блоками и цветами органов.【F:js/render.js†L1-L96】
- `js/ui.js` — UI/настройки/лог/симбиоз, обработчики интерфейса и буфера обмена.【F:js/ui.js†L1-L200】
- `js/creature.js` — создание существа, тело, стадии, рост и базовая морфология.【F:js/creature.js†L1-L195】
- `js/rules-data.js` — текстовые правила, отображаемые в UI.【F:js/rules-data.js†L1-L78】

### 6.3 Структура данных (состояние)
Ключевые поля состояния (создаются в `newGame()` и нормализуются в `migrateOrNew()`):
- **seed** — источник детерминизма для генерации и мутаций.
- **body / modules** — клетки тела и модульные органы.
- **bars / care** — параметры состояния (еда/чистота/HP/настроение) и история ухода.
- **carrots / inv** — взаимодействие с морковками и их запасом.
- **buds** — дочерние организмы (почкование).
Все эти поля явно задаются при создании состояния или нормализуются при миграции.【F:js/creature.js†L115-L195】【F:js/state.js†L20-L151】

## 7. Визуал и рендер
- Canvas-рендер без спрайтов: 1 блок = `--cellSize` пикселей, дыхание, рост, подсветка и масштабирование реализованы в `render.js`.【F:js/render.js†L1-L33】
- Цвета органов рассчитываются из базовой палитры и могут смещаться по тону (hue shift).【F:js/render.js†L34-L96】

## 8. Сохранения и миграции
- Сейвы лежат в `localStorage` под ключом `symbiochi_v6_save`.
- `migrateOrNew()` либо создаёт новое состояние, либо нормализует старое и сохраняет его обратно.【F:js/state.js†L1-L151】

## 9. Симбиоз (обмен геномом)
- UI симбиоза позволяет делиться «отпечатком» организма и применять его к текущему состоянию (слияние геномов).【F:js/ui.js†L139-L200】
- Логика слияния геномов реализована в `applySymbiosisMerge()` и связанных функциях.【F:js/state_mutation.js†L28-L73】

## 10. Расширение и модификации
### 10.1 Добавление новых органов
- Органы подключаются в `creature.js` и реализуются как отдельные модули в `js/organs/`.【F:js/creature.js†L1-L16】

### 10.2 Изменение правил эволюции
- Основная логика мутаций/экологии находится в `state_mutation.js` и вызывается из симуляции в `state.js`.【F:js/state_mutation.js†L28-L73】【F:js/state.js†L171-L215】

### 10.3 Настройка интерфейса
- Элементы UI описаны в `index.html`, логика событий — в `ui.js` и `main.js`.【F:index.html†L10-L140】【F:js/ui.js†L1-L200】【F:js/main.js†L1-L104】

## 11. Технические детали
- **Стек**: HTML5 + Canvas + ES Modules, без сборки и зависимостей.【F:README.md†L109-L118】
- **Рендер**: процедурный, пиксельный, рассчитан на мягкую анимацию и рост клеток.【F:README.md†L95-L105】【F:js/render.js†L1-L33】

## 12. Открытые вопросы и будущие улучшения
- Дальнейшая балансировка параметров эволюции и влияния ухода.
- Расширение типов органов и экосистемных эффектов.
- Улучшение визуальных эффектов и читаемости журнала.

---
Этот диздок можно расширять разделами про баланс, формулы мутаций и UX-исследования по мере развития проекта.
